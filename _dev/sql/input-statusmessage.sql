WITH attr AS\r\n(SELECT recordid,\r\n	[400] AS [packageid],\r\n	[401] AS [advertisementid],\r\n	[402] AS [collectionid],\r\n	[403] AS [username],\r\n	[404] AS [dp],\r\n	[405] AS [policyid],\r\n	[406] AS [policyassignmentid],\r\n	[407] AS [meter_ruleid],\r\n	[408] AS [client_sms_uniqueid],\r\n	[409] AS [site_code],\r\n	[410] AS [package_version],\r\n	[411] AS [time_key],\r\n	[412] AS [unique_updateid],\r\n	[413] AS [productid],\r\n	[414] AS [ci_assignmentid],\r\n	[415] AS [objectid],\r\n	[416] AS [object_type],\r\n	[417] AS [sdm_typeid],\r\n	[418] AS [sdm_type_version],\r\n	[419] AS [update_source_uniqueid],\r\n	[420] AS [collection_extended_propsid],\r\n	[421] AS [wol_object_type],\r\n	[422] AS [wol_batchid],\r\n	[423] AS [machine_extended_propsid],\r\n	[424] AS [wol_num_requests],\r\n	[425] AS [unknown_machine],\r\n	[426] AS [mac_addresses],\r\n	[427] AS [smbiosid]\r\nFROM \r\n	(Select RecordId, AttributeId, AttributeValue from v_StatMsgAttributes) as s\r\n	PIVOT (MAX(AttributeValue) FOR [AttributeId] IN ([400], [401], [402], [403], [404], [405], [406], [407], [408], [409], [410], [411], [412], [413], [414], [415], [416], [417], [418], [419], [420], [421], [422], [423], [424], [425], [426], [427])) as piv\r\n)\r\nSELECT msg.recordid,\r\n  convert(datetime,SWITCHOFFSET(CONVERT(DATETIMEOFFSET(3), msg.[time] ), DATENAME(TzOffset, SYSDATETIMEOFFSET()))) As [timestamp],\r\n  msg.[time] as [timestamputc],\r\n  msg.messageid,\r\n  severity = \r\n    CASE msg.severity\r\n      WHEN 1073741824 THEN 'informational'\r\n	  WHEN -1073741824 THEN 'error'\r\n	  WHEN -2147483648 THEN 'warning'\r\n    END,\r\n  msg.severity AS severityid,\r\n  msg.machinename,\r\n  msg.sitecode,\r\n  msg.modulename,\r\n  msg.component,\r\n  replace(strings.insstring1,'"','') as string1,\r\n  replace(strings.insstring2,'"','') as string2,\r\n  replace(strings.insstring3,'"','') as string3,\r\n  replace(strings.insstring4,'"','') as string4,\r\n  replace(strings.insstring5,'"','') as string5,\r\n  replace(strings.insstring6,'"','') as string6,\r\n  replace(strings.insstring7,'"','') as string7,\r\n  replace(strings.insstring8,'"','') as string8,\r\n  replace(strings.insstring9,'"','') as string9,\r\n  replace(strings.insstring10,'"','') as string10,\r\n  packageid, \r\n  advertisementid, \r\n  collectionid, \r\n  username, \r\n  replace(dp,'"','') as dp, \r\n  policyid, \r\n  policyassignmentid, \r\n  meter_ruleid, \r\n  client_sms_uniqueid, \r\n  site_code, \r\n  package_version, \r\n  time_key, \r\n  unique_updateid, \r\n  productid, \r\n  ci_assignmentid, \r\n  objectid, \r\n  object_type, \r\n  sdm_typeid, \r\n  sdm_type_version, \r\n  update_source_uniqueid, \r\n  collection_extended_propsid, \r\n  wol_object_type, \r\n  wol_batchid, \r\n  machine_extended_propsid, \r\n  wol_num_requests, \r\n  unknown_machine, \r\n  mac_addresses, \r\n  smbiosid \r\nfrom v_StatusMessage  msg\r\nleft join v_StatMsgWithInsStrings  strings\r\n  on msg.recordid = strings.recordid\r\nleft join attr\r\n  on msg.recordid = attr.recordid\r\n